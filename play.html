<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Run Rabbit</title>
<style>
  /* Corps de page */
  body {
    margin: 0;
    overflow: hidden;
    height: 100vh;
    font-family: Arial, sans-serif;
    background-image: url('./background.png');
    background-repeat: repeat-x;
    background-size: auto 100vh; /* couvre la hauteur */
    background-position: 0 0;
  }

  /* En mode paysage (horizontal) on ajuste le background */
  @media (orientation: landscape) {
    body {
      background-size: cover; /* en paysage on couvre tout */
    }
  }

  /* Lapin */
  #character {
    position: absolute;
    width: 80px;
    height: 80px;
    background-image: url('./rabbit.png');
    background-size: contain;
    background-repeat: no-repeat;
    left: 30px;
    bottom: 140px; /* sol fixe */
    z-index: 10;
  }

  /* Obstacles */
  .obstacle {
    position: absolute;
    width: 80px;
    height: 80px;
    background-image: url('./obstacle.png');
    background-size: contain;
    background-repeat: no-repeat;
    bottom: 110px;
  }

  /* Carottes */
  .carrot {
    position: absolute;
    width: 50px;
    height: 50px;
    background-image: url('./carotte.png');
    background-size: contain;
    background-repeat: no-repeat;
    bottom: 140px; /* mÃªme niveau que lapin */
    z-index: 9;
  }

  /* Score */
  #carrotScore {
    position: absolute;
    top: 20px;
    left: 20px;
    font-size: 24px;
    color: white;
    background: rgba(0, 0, 0, 0.5);
    padding: 10px 15px;
    border-radius: 10px;
    user-select: none;
    z-index: 20;
  }
</style>
</head>
<body>
  <div id="character"></div>
  <div id="carrotScore">ðŸ¥• x 0</div>

<script>
  const character = document.getElementById('character');
  const carrotScoreDisplay = document.getElementById('carrotScore');

  const groundY = 140; // position sol lapin
  const obstacleY = 110; // position sol obstacles
  const carrotY = 140;   // position sol carottes (mÃªme que lapin)

  let isJumping = false;
  let jumpCount = 0;
  let velocity = 0;
  const gravity = 1;
  const jumpStrength = 20;

  let backgroundX = 0;
  const speed = 6;

  let obstacles = [];
  let carrots = [];
  let carrotScore = 0;
  let gameRunning = true;

  let characterBottom = groundY;

  // Gestion saut
  function jump() {
    if (jumpCount < 2) {
      velocity = jumpStrength;
      isJumping = true;
      jumpCount++;
    }
  }

  document.addEventListener('keydown', e => {
    if (e.code === 'Space') {
      e.preventDefault();
      jump();
    }
  });

  document.addEventListener('click', jump);

  function updateCharacter() {
    if (isJumping || characterBottom > groundY) {
      velocity -= gravity;
      characterBottom += velocity;
      if (characterBottom <= groundY) {
        characterBottom = groundY;
        isJumping = false;
        jumpCount = 0;
        velocity = 0;
      }
      character.style.bottom = characterBottom + 'px';
    }
  }

  // Spawn obstacles
  function spawnObstacle() {
    const obstacle = document.createElement('div');
    obstacle.classList.add('obstacle');
    obstacle.style.left = window.innerWidth + 'px';
    obstacle.style.bottom = obstacleY + 'px';
    obstacle.dataset.posX = window.innerWidth;
    document.body.appendChild(obstacle);
    obstacles.push(obstacle);
  }

  // Spawn carottes
  function spawnCarrot() {
    const carrot = document.createElement('div');
    carrot.classList.add('carrot');
    carrot.style.left = window.innerWidth + 'px';
    carrot.style.bottom = carrotY + 'px';
    carrot.dataset.posX = window.innerWidth;
    document.body.appendChild(carrot);
    carrots.push(carrot);
  }

  let obstacleTimer = 0;
  let carrotTimer = 0;
  let nextObstacleDelay = Math.random() * 300 + 600;
  let nextCarrotDelay = Math.random() * 1000 + 500;

  function gameLoop() {
    if (!gameRunning) return;

    // Background scroll horizontal rÃ©pÃ©tÃ©
    backgroundX -= speed;
    document.body.style.backgroundPosition = `${backgroundX}px 0`;

    updateCharacter();

    // Mise Ã  jour obstacles
    for (let i = obstacles.length - 1; i >= 0; i--) {
      const obstacle = obstacles[i];
      let posX = parseFloat(obstacle.dataset.posX);
      posX -= speed;
      obstacle.dataset.posX = posX;
      obstacle.style.left = posX + 'px';

      const rabbitRect = character.getBoundingClientRect();
      const obsRect = obstacle.getBoundingClientRect();

      if (
        obsRect.left < rabbitRect.right &&
        obsRect.right > rabbitRect.left &&
        obsRect.top < rabbitRect.bottom &&
        obsRect.bottom > rabbitRect.top
      ) {
        gameRunning = false;
        alert('Game Over !');
        window.location.href = 'index.html';
        return;
      }

      if (posX < -100) {
        obstacle.remove();
        obstacles.splice(i, 1);
      }
    }

    // Mise Ã  jour carottes
    for (let i = carrots.length - 1; i >= 0; i--) {
      const carrot = carrots[i];
      let posX = parseFloat(carrot.dataset.posX);
      posX -= speed;
      carrot.dataset.posX = posX;
      carrot.style.left = posX + 'px';

      const rabbitRect = character.getBoundingClientRect();
      const carrotRect = carrot.getBoundingClientRect();

      if (
        carrotRect.left < rabbitRect.right &&
        carrotRect.right > rabbitRect.left &&
        carrotRect.top < rabbitRect.bottom &&
        carrotRect.bottom > rabbitRect.top
      ) {
        carrotScore++;
        carrotScoreDisplay.textContent = `ðŸ¥• x ${carrotScore}`;
        carrot.remove();
        carrots.splice(i, 1);
      }

      if (posX < -100) {
        carrot.remove();
        carrots.splice(i, 1);
      }
    }

    obstacleTimer += speed;
    carrotTimer += speed;

    if (obstacleTimer >= nextObstacleDelay) {
      spawnObstacle();
      obstacleTimer = 0;
      nextObstacleDelay = Math.random() * 300 + 600;
    }

    if (carrotTimer >= nextCarrotDelay) {
      spawnCarrot();
      carrotTimer = 0;
      nextCarrotDelay = Math.random() * 1000 + 500;
    }

    requestAnimationFrame(gameLoop);
  }

  // Init position lapin et lancement boucle
  character.style.bottom = groundY + 'px';
  gameLoop();
</script>
</body>
</html>
